<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>API 연습</title>
</head>

<body>
    <h1>ajax를 통한 api와 소통하기  </h1>
    <input id="foodName" value="" type="text">
    <button id="search">검색</button>

    <p></p>
    <div id="div-element">list</div>
    <script src="https://code.jquery.com/jquery-3.4.1.js"
        integrity="sha256-WpOohJOqMqqyKL9FccASB9O0KwACQJpFTUBLTYOVvVU=" crossorigin="anonymous"></script>
    <script>
        function follow(DESCKOR) {
            var el = document.getElementById("div-element");
            el.textContent = DESCKOR.DESC_KOR + "1회제공량 (g): " + DESCKOR.SERVING_WT
             + '<br>' + "열량 (kcal): " + DESCKOR.NUTR_CONT1 + '<br>' + "탄수화물 (g): " + DESCKOR.NUTR_CONT2 + '<br>' + "단백질 (g) " + DESCKOR.NUTR_CONT3;
        }
        $(document).ready(function () {
            $("#search").click(function () {
                var exurl = 'http://apis.data.go.kr/1471000/FoodNtrIrdntInfoService1/getFoodNtrItdntList1'; /*URL*/
                var queryParams = '?' + encodeURIComponent('serviceKey') + '='+'IBqx4TwSMeJC70Y4WRvQHoKGVqLDifv0%2F2qGaKK0VlPx7Gh42nrfXeAQz7%2F3%2BtV%2Bd34PtzYvmIPOy%2FFmWRFUDw%3D%3D'; /*Service Key*/
                queryParams += '&' + encodeURIComponent('type') + '=' + encodeURIComponent('json'); /*Json 형태로 받기*/
                var val1 = $("#foodName").val();
                queryParams += '&' + encodeURIComponent('desc_kor') + '=' + encodeURIComponent(val1); /*음식검색*/
                queryParams += '&' + encodeURIComponent('pageNo') + '=' + encodeURIComponent('1'); /**/
                //var val2 =; 리스트의 값 

                $.ajax({
                    method: "GET",
                    url: exurl + queryParams,
                })
                    .done(function (msg) {
                        $("p").empty();
                        for(var i = 0; i <msg.body.items.length; i++){
                            $("p").append('<li id="li-element">' + msg.body.items[i].DESC_KOR + "</li>");  
                        }
                        
                        $(document).ready(function() {
                          $('p').append(_.map(msg.body.items, function(foodN) {
                            var food = $('<button type="button" class="btn btn-primary">').text(food.DESC_KOR);
                            foodList.click(function() {
                                if (confirm(food.DESC_KO + "님을팔로잉하시겠습니까?")) follow(user);
                            });
                            return button;
                          }));  
                        });
                        
                        function follow(user) {
                            alert("이제 " + user.name + "님의소식을보실수있습니다.");
                        }

                               
                                    $("div").empty();
                                    console.log(imf.body.items.length);
                                    for(var i = 0; i <imf.body.items.length; i++){
                                        $("div").append(val2);//값이 0으로 출력
                                        if(imf.body.items[i].DESC_KOR == val2.val){
                                            $("div").append("<h3>" + "영양 정보" + "</h3>");
                                            $("div").append("<li>" + "1회제공량 (g)" + imf.body.items[i].SERVING_WT + "</li>");
                                            $("div").append("<li>" + "열량 (kcal)" + imf.body.items[i].NUTR_CONT1 + "</li>");
                                            $("div").append("<li>" + "식품이름" + imf.body.items[i].NUTR_CONT2 + "</li>");
                                            $("div").append("<li>" + "식품이름" + imf.body.items[i].NUTR_CONT3 + "</li>");   
                                        }
                                    }
                        });
                    });
            });
        });
    </script>
</body>
</html>